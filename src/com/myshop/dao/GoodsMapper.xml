<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myshop.dao.GoodsMapper">
	<select id="queryGoodsCount" resultType="int">
		SELECT count(*) from goods
	</select>
	
	<select id="querySearchGoodsCount" parameterType="Goods" resultType="int">
		SELECT count(*) from goods where name LIKE '${name}%'
	</select>

	<!-- 查询商品按时间排序 -->
	<select id="queryGoodsTime" parameterType="PageModel" resultType="Goods">
		SELECT
		g.id, g.name, g.img, g.marketprice, g.sellprice from goods g ORDER BY g.createtime DESC 
		LIMIT #{startIndex}, #{pageSize}
	</select>

	<!-- 查询商品按点击数排序 -->
	<select id="queryGoodsClickcount" resultType="Goods">
		SELECT id, name, img, clickcount from goods ORDER BY clickcount DESC LIMIT 5
	</select>
	
	<!-- 查询商品按点击数排序带分页 -->
	<select id="queryGoodsClickcountPage" parameterType="PageModel" resultType="Goods">
		SELECT 
		g.id, g.name, g.img, g.marketprice, g.sellprice from goods g ORDER BY g.clickcount DESC 
		LIMIT #{startIndex}, #{pageSize}
	</select>
	
	<!-- 查询商品按卖出数量排序 -->
	<select id="queryGoodsSellcount" resultType="Goods">
		SELECT id, name, img, clickcount from goods ORDER BY sellcount DESC LIMIT 4
	</select>
	
	<!-- 查询商品按卖出数量排序带分页 -->
	<select id="queryGoodsSellcountPage" parameterType="PageModel" resultType="Goods">
		SELECT 
		g.id, g.name, g.img, g.marketprice, g.sellprice from goods g ORDER BY g.sellcount DESC 
		LIMIT #{startIndex}, #{pageSize}
	</select>
	
	<!-- 按商品名称模糊查询 -->
	<select id="queryGoodsByName" parameterType="PageModel" resultType="Goods">
		select g.id, g.img, g.`name`, g.marketprice, g.sellprice from goods g where g.`name` LIKE '${pageQuery.name}%'
		LIMIT #{startIndex}, #{pageSize}
	</select>
	
	<!-- 查询分类商品数量 -->
	<select id="queryGoodsCategoryCount" parameterType="Goods" resultType="int">
		select count(*) from category cat
		LEFT JOIN goods g on cat.id = g.categoryId
		where cat.id = #{categoryId}
	</select>
	
	<!-- 按分类名称查询商品 -->
	<select id="queryGoodsByCategory" parameterType="PageModel"  resultType="Goods">
		select g.id, g.img, g.`name`, g.marketprice, g.sellprice from category cat
		LEFT JOIN goods g on cat.id = g.categoryId
		where cat.id = #{pageQuery.categoryId}
		LIMIT #{startIndex}, #{pageSize}
	</select>
	
	<!-- 通过id查找商品 -->
	<select id="queryGoodsById" parameterType="Integer" resultType="Goods">
		select g.id, g.img, g.`name`, g.marketprice, g.sellprice, g.desc from goods g where g.id = #{id} limit 1
	</select>
	
	<!-- 更新点击数 -->
	<update id="updateClickCount" parameterType="Integer">
		update goods set clickcount = clickcount + 1 where id = #{id}
	</update>

	<!-- 更新卖出数 -->
	<update id="updateSellCount" parameterType="List">
		update goods set sellcount = sellcount + 1 where id in
		<foreach collection="list" item="id" index="index" separator="," open="(" close=")">
			#{id}
		</foreach>
	</update>
</mapper>